# Ryjinx Launcher (macOS)

A native macOS SwiftUI game launcher for Ryujinx with Metal-powered visuals, real metadata extraction, and WidgetKit widgets. Built for Apple Silicon and macOS 15.

## Highlights
- SwiftUI MVVM architecture
- Metal background + shader overlay pipeline
- Real Ryujinx game discovery and playtime extraction
- SteamGridDB for artwork (covers), cached on disk
- Launcher console with live Ryujinx stdout/stderr
- WidgetKit: Recently Played, Top Played, Quick Launch
- App integrations: URL scheme, App Shortcuts, Spotlight indexing, notifications
- Finder integrations: file associations + Quick Look preview + Share extension
- Game Mode activity hints when fullscreen or launching

## Requirements
- macOS 15.0+
- Xcode 16.x
- Apple Silicon (ARM64)
- Command line tools: `xcodegen`

Install Xcodegen if missing:
```bash
brew install xcodegen
```

## Project Layout
- App source: `/Users/<USERNAME>/Documents/launcher/Sources/RyjinxLauncher`
- Shared app/widget data: `/Users/<USERNAME>/Documents/launcher/Sources/RyjinxLauncher/Shared`
- Widgets: `/Users/<USERNAME>/Documents/launcher/Sources/RyjinxLauncherWidgets`
- Quick Look extension: `/Users/<USERNAME>/Documents/launcher/Sources/RyjinxLauncherQuickLook`
- Share extension: `/Users/<USERNAME>/Documents/launcher/Sources/RyjinxLauncherShare`
- Project config: `/Users/<USERNAME>/Documents/launcher/project.yml`

## Generate the Xcode Project
The project is generated from `project.yml`.
```bash
cd /Users/<USERNAME>/Documents/launcher
xcodegen generate
```

Open the project:
```bash
open /Users/<USERNAME>/Documents/launcher/RyjinxLauncher.xcodeproj
```

## Build & Run
1. Select the **RyjinxLauncher** scheme.
2. Choose **My Mac** (or any macOS device) as the run destination.
3. Build and run.

## Initial Setup in the App
1. Open **Settings**.
2. Select:
   - Ryujinx executable directory
   - Games directory
3. The launcher will scan, index, and cache art automatically.

## App Groups & Entitlements
The app and extensions share data through App Groups.
- App Group ID: `group.com.ryjinx.launcher`

Entitlements are generated by `project.yml`. If you edit entitlements manually, re-run:
```bash
xcodegen generate
```

## Artwork + Caching
- Cover art is fetched via SteamGridDB and cached in the App Group container.
- Cache lives under the shared container path `thumbnails`.
- Clear the cache in Settings.

## Widgets
Widgets read data from the App Group snapshot. They are safe-only SwiftUI (no Metal).

Schemes:
- `RyjinxLauncherWidgets`

Add widgets from the macOS widget gallery.

## Quick Launch Widget
- Triggers a real app launch via App Intent.
- Validates Ryujinx and game paths before launch.
- If invalid, the launcher opens without launching.

## Finder Integration
### File Types
The app registers these extensions:
- `.nsp`, `.xci`, `.nro`, `.nca`, `.nsz`

### Quick Look
Select a file in Finder and press **Space** to preview.

### Share Extension
Use Finder’s **Share** menu to send a game file to the launcher.

## URL Scheme / Deep Links
Scheme: `ryjinx://`

Examples:
- `ryjinx://open?settings=1`
- `ryjinx://launch?id=GAME_ID`
- `ryjinx://launch?path=/full/path/to/game.nsp`

## Shortcuts (App Intents)
- Open launcher
- Launch last played
- Launch specific game

## Troubleshooting
### Widgets fail to load
- Make sure App Groups are enabled and match `group.com.ryjinx.launcher`.
- Rebuild the widget target and relaunch the widget gallery.

### Open panel fails (sandbox errors)
- Ensure the app has `User Selected File Read` entitlement (set in `project.yml`).

### Ryujinx not found
- Select the **directory** containing the Ryujinx executable (not the .app wrapper).
- The launcher validates the executable path on selection.

### Quick Look or Share extension not appearing
- Confirm the extensions are enabled in **System Settings → Privacy & Security → Extensions**.

## Development Notes
- Metal shaders live in `/Users/<USERNAME>/Documents/launcher/Sources/RyjinxLauncher/Metal`.
- Background rendering is layered:
  1. Background image layer
  2. Metal shader overlay
  3. SwiftUI foreground UI
- Widget UI uses the `containerBackground` API and safe image loading.

## License
Private project for Ryjinx Launcher. All rights reserved.
